---
title: Metadatos en Paquetes
author: Martín Macías
date: '2018-04-26'
slug: metadatos-en-paquetes
categories: []
tags: []
draft: TRUE
---

## Metadatos en paquetes

El trabajo del archivo DESCRIPTION es almacenar metadatos importantes sobre su paquete. Cuando comience a escribir paquetes, generalmente usará estos metadatos para registrar qué paquetes son necesarios para ejecutar su paquete. Sin embargo, a medida que pase el tiempo y comience a compartir su paquete con otros, el archivo de metadatos se vuelve cada vez más importante porque especifica quién puede usarlo (la licencia) y con quién contactarse (¡usted!) si hay algún problema.

Cada paquete debe tener un DESCRIPTION. De hecho, es la característica definitivaa de un paquete (RStudio y devtools consideran cualquier directorio que contiene DESCRIPTION como un paquete). Para comenzar, `devtools::create("mypackage")` agrega automáticamente un escueto archivo de descripción. Esto le permitirá comenzar a escribir el paquete sin tener que preocuparse por los metadatos hasta que lo necesite. La descripción mínima variará un poco dependiendo de su configuración, pero debería verse más o menos así:

```yaml
Package: mypackage
Title: What The Package Does (one line, title case required)
Version: 0.1
Authors@R: person("First", "Last", email = "first.last@example.com",
                  role = c("aut", "cre"))
Description: What the package does (one paragraph)
Depends: R (>= 3.1.0)
License: What license is it under?
LazyData: true
```

(Si está escribiendo muchos paquetes, puede establecer opciones globales mediante `devtools.desc.author`, `devtools.desc.license`, `devtools.desc.suggests`, y `devtools.desc`. Consulte `package?devtools` para más detalles.)

`DESCRIPTION` usa un formato de archivo simple llamado DCF, el formato de control de Debian. Puede ver la mayoría de la estructura en el ejemplo simple a continuación. Cada línea consiste en un nombre __field__ y un valor, separados por dos puntos. Cuando los valores abarcan varias líneas, deben sangrarse:

```yaml
Description: The description of a package is usually long,
    spanning multiple lines. The second and subsequent lines
    should be indented, usually with four spaces.
```

Este capítulo le mostrará cómo usar los campos `DESCRIPTION` más importantes.

### Dependencias: ¿Qué necesita su paquete?

El trabajo de `DESCRIPTION` es enumerar los paquetes que su paquete necesita para funcionar. R tiene un amplio conjunto de formas de describir posibles dependencias. Por ejemplo, las siguientes líneas indican que su paquete necesita tanto `ggvis` como `dplyr` para funcionar:


```yaml
Imports:
    dplyr,
    ggvis
```

Mientras que las líneas a continuación indican que, si bien su paquete puede aprovechar `ggvis` y `dplyr`, no se necesitan para que funcionen:

```yaml
Suggests:
    dplyr,
    ggvis
```

Tanto `Imports` como `Suggests` toman una lista de nombres de paquetes separados por comas. Recomiendo poner un paquete en cada línea, y mantenerlos en orden alfabético. Eso hace que sea fácil de revisar.

`Imports` y `Suggests` difieren en su fuerza de dependencia:

*   `Imports`: los paquetes enumerados aquí _deben_ estar presentes para que su paquete trabaje. De hecho, cada vez que su paquete sea instalado, esos paquetes, si no están presentes, serán instalados en su computadora  (`devtools::load_all()` también verifica que los paquetes estén instalados).
    
    Agregar una dependencia de paquete aquí asegura que se instalará. Sin embargo, no significa que se adjuntará junto con su paquete (es decir, `library(x)`). La mejor práctica es referirse explícitamente a funciones que usan la sintaxis `package::function()`. Esto hace que sea muy fácil identificar qué funciones viven fuera de su paquete. Esto es especialmente útil cuando lea su código en el futuro. [Va](http://r-pkgs.had.co.nz/namespace.html#imports)
    
    Si usa muchas funciones de otros paquetes, esto es bastante diciente. También hay una penalización de rendimiento menor asociada con `::` (del orden de 5μs, entonces solo importará si llama a la función millones de veces). Aprenderá formas alternativas de llamar a funciones en otros paquetes en [namespace imports] (http://r-pkgs.had.co.nz/namespace.html#imports).

*   `Suggests`: su paquete puede usar estos paquetes, pero no los requiere. Puede usar paquetes sugeridos para conjuntos de datos de ejemplo, para ejecutar pruebas, crear viñetas, o tal vez solo hay una función que necesite el paquete.
  
    Los paquetes enumerados en `Suggets` no se instalan automáticamente junto con su equipaje. Esto significa que debe verificar si el paquete está disponible antes de usarlo (use `requireNamespace(x, quietly = TRUE)`). Existen dos escenarios básicos:
    
    
    ```{r}
    # Necesita el paquete sugerido para esta función    
    my_fun <- function(a, b) {
      if (!requireNamespace("pkg", quietly = TRUE)) {
        stop("Paquete \"pkg\" necesario para que esta función trabaje. Por favor, instálela.",
          call. = FALSE)
      }
    }
    
    # Hay un método alternativo si el paquete no está disponible
    my_fun <- function(a, b) {
      if (requireNamespace("pkg", quietly = TRUE)) {
        pkg::f()
      } else {
        g()
      }
    }
    ```    
    
Al desarrollar paquetes localmente, nunca necesitará usar `Suggests`. Cuando libere su paquete, usar `Suggests` es una cortesía para sus usuarios. Les permite descargar paquetes que rara vez se necesitan y les permite comenzar con su paquete lo más rápido posible.

La forma más fácil de agregar `Imports` y` Suggests` a su paquete es usar `devtools::use_package()`. Esto los coloca automáticamente en el lugar correcto en su `DESCRIPTION`, y le recuerda cómo usarlos.


```{r, eval = FALSE}
devtools::use_package("dplyr") # Por defecto para importar
#> Agrega dplyr a Imports
#> Consulte las funciones con dplyr::fun()
devtools::use_package("dplyr", "Suggests")
#> Agrega dplyr a Suggests
#> Use requireNamespace("dplyr", quietly = TRUE) para probar si el
#>  paquete está instalado, luego use dplyr::fun() para referirse a
#> a las funciones
```

#### Versiones

Si necesita una versión específica de un paquete, especifíquelo en paréntesis después del nombre del paquete:

```yaml
Imports:
    ggvis (>= 0.2),
    dplyr (>= 0.3.0.1)
Suggests:
    MASS (>= 7.3.0)
```

Casi siempre debería especificar una versión mínima en lugar de una versión exacta (`MASS (==7.3.0)`). Como R no puede tener múltiples versiones del mismo paquete cargadas al mismo tiempo, la especificación de una dependencia exacta aumenta drásticamente las posibilidades de versiones en conflicto.

El control de versiones es más importante cuando lanza su paquete. Por lo general, las personas no tienen exactamente las mismas versiones de paquetes instalados que usted. Si alguien tiene un paquete anterior que no tiene una función que su paquete necesita, recibirá un mensaje de error inútil. Sin embargo, si proporciona el número de versión, recibirán un mensaje de error que les dice exactamente cuál es el problema: un paquete desactualizado.

En general, siempre es mejor especificar la versión y ser conservador sobre qué versión requerir. A menos que sepa lo contrario, siempre solicite una versión mayor o igual que la versión que esté utilizando actualmente.